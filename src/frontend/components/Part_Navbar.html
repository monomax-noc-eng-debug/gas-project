<div class="navbar bg-base-100 border-b border-base-200 px-4 z-40 sticky top-0 shadow-sm min-h-[4rem]">

  <div class="flex-1 gap-2 items-center">

    <label for="my-drawer" class="btn btn-square btn-ghost lg:hidden drawer-button">
      <i class="fas fa-bars text-xl"></i>
    </label>

    <h2 class="text-lg md:text-xl font-bold text-base-content truncate max-w-[150px] md:max-w-none" id="header-title">
      แดชบอร์ด
    </h2>
  </div>

  <div class="flex-none gap-2">


    <div class="divider divider-horizontal mx-0 hidden md:flex"></div>

    <div class="dropdown dropdown-end">
      <div tabindex="0" role="button"
        class="btn btn-ghost flex items-center gap-2 px-1 md:px-2 rounded-btn h-auto py-1">
        <div class="avatar placeholder placeholder-online">
          <div class="bg-primary text-primary-content rounded-full w-8 md:w-9">
            <span id="nav-avatar-text" class="text-sm md:text-lg font-bold">U</span>
            <img id="nav-avatar-img" class="hidden" src="" alt="Avatar" />
          </div>
        </div>
        <div class="hidden md:block text-right leading-tight normal-case">
          <p id="nav-user-name" class="font-bold text-sm text-base-content">Loding...</p>
          <p id="nav-user-email" class="text-xs text-base-content/60">...</p>
        </div>
        <i class="fas fa-chevron-down text-xs text-base-content/50 ml-1 hidden md:block"></i>
      </div>
      <ul tabindex="0"
        class="dropdown-content z-[1] menu p-2 shadow-lg bg-base-100 rounded-box w-52 mt-4 border border-base-200">
        <li class="menu-title px-4 py-2">
          <span class="text-xs font-semibold opacity-50">บัญชีผู้ใช้</span>
        </li>
        <li class="px-4 py-2 text-xs text-base-content/70 break-all" id="nav-menu-email">
          checking...
        </li>
        <div class="divider my-0"></div>
        <li><a onclick="Router.navigateTo('page-settings')"><i class="fas fa-cog w-4 text-center"></i> ตั้งค่าระบบ</a>
        </li>
        <li class="border-t border-base-200 my-1"></li>
        <li><a class="text-error hover:bg-error/10" href="https://accounts.google.com/Logout" target="_blank"><i
              class="fas fa-sign-out-alt w-4 text-center"></i> ออกจากระบบ</a>
        </li>
      </ul>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Simple Profile Loader
    const updateNav = () => {
      const user = Store.state.currentUser;
      if (user) {
        // Name
        const nameEl = document.getElementById('nav-user-name');
        if (nameEl) nameEl.innerText = user.name || 'User';

        // Email (Subtitle)
        const emailEl = document.getElementById('nav-user-email');
        if (emailEl) emailEl.innerText = user.email || '';

        // Email (Menu)
        const menuEmailEl = document.getElementById('nav-menu-email');
        if (menuEmailEl) menuEmailEl.innerText = user.email || '';

        // Avatar
        const imgEl = document.getElementById('nav-avatar-img');
        const textEl = document.getElementById('nav-avatar-text');

        if (user.picture) {
          if (imgEl) { imgEl.src = user.picture; imgEl.classList.remove('hidden'); }
          if (textEl) textEl.classList.add('hidden');
        } else {
          if (imgEl) imgEl.classList.add('hidden');
          if (textEl) {
            textEl.classList.remove('hidden');
            textEl.innerText = (user.name || 'U').charAt(0).toUpperCase();
          }
        }
      }
    };

    // Watch for store init
    // Since Store.init() is async, we can check interval or listen to event.
    // Or simply call it once, and let JS_App.html call it when ready. 
    // JS_App calls Store.init(). We can hook into it.
    // Better: Use an interval to check Store state for a few seconds.
    let attempts = 0;
    const interval = setInterval(() => {
      if (Store.state.currentUser) {
        updateNav();
        clearInterval(interval);
      }
      attempts++;
      if (attempts > 50) clearInterval(interval); // 5 sec timeout
    }, 100);
  });
</script>