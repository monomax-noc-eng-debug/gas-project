<div class="navbar bg-base-100 border-b border-base-200 px-4 z-40 sticky top-0 shadow-sm min-h-[4rem]">

  <div class="flex-1 gap-2 items-center">
    <label for="my-drawer" class="btn btn-square btn-ghost lg:hidden drawer-button">
      <i class="fas fa-bars text-xl"></i>
    </label>

    <h2 class="text-lg md:text-xl font-bold text-base-content truncate max-w-[150px] md:max-w-none" id="header-title">
      แดชบอร์ด
    </h2>
  </div>

  <div class="flex-none gap-2">
    <div class="divider divider-horizontal mx-2 hidden md:flex h-8 self-center"></div>

    <div class="dropdown dropdown-end">

      <div tabindex="0" role="button"
        class="btn btn-ghost h-auto py-1 px-2 flex items-center gap-3 rounded-full hover:bg-base-200 transition-all duration-200">

        <div class="hidden md:flex flex-col items-end gap-0.5 mr-1">
          <span id="nav-user-name" class="font-bold text-sm leading-none text-base-content">Loading...</span>
          <span class="text-[10px] text-base-content/60 leading-none uppercase tracking-wide">User</span>
        </div>

        <div class="avatar placeholder">
          <div
            class="w-9 md:w-10 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2 transition-all duration-300 hover:scale-105">
            <img id="nav-avatar-img" class="hidden" src="" alt="Avatar" />
            <span id="nav-avatar-text" class="text-lg font-bold bg-neutral text-neutral-content w-full h-full flex items-center justify-center">U</span>
          </div>
        </div>

        <i class="fas fa-chevron-down text-[10px] opacity-50 hidden md:block ml-1"></i>
      </div>

      <ul tabindex="0"
        class="dropdown-content z-[100] menu p-2 shadow-2xl bg-base-100 rounded-2xl w-72 mt-3 border border-base-200/60 animate-fade-in-up">

        <li class="disabled pointer-events-none mb-2">
          <div class="flex flex-col gap-1 p-4 bg-base-200/50 rounded-xl items-center text-center">
            <div class="avatar mb-2">
              <div class="w-16 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2">
                <img id="nav-menu-avatar-img" class="hidden" src="" alt="Avatar" />
                <span id="nav-menu-avatar-text" class="text-3xl font-bold bg-neutral text-neutral-content w-full h-full flex items-center justify-center">U</span>
              </div>
            </div>
            <div>
              <p class="font-bold text-lg text-base-content" id="nav-menu-name-display">User Name</p>
            </div>
          </div>
        </li>

        <li>
          <a onclick="Router.navigateTo('page-settings')"
            class="flex gap-3 py-3 font-medium hover:bg-base-200 rounded-lg group">
            <div
              class="w-8 h-8 rounded-full bg-base-200 flex items-center justify-center text-base-content/70 group-hover:bg-primary group-hover:text-primary-content transition-colors duration-200">
              <i class="fas fa-cog"></i>
            </div>
            <div class="flex flex-col">
              <span class="text-sm">ตั้งค่าระบบ</span>
              <span class="text-[10px] opacity-60 font-normal">จัดการข้อมูลและการแจ้งเตือน</span>
            </div>
          </a>
        </li>

        <div class="divider my-1"></div>

        <li>
          <a onclick="handleLogout()"
            class="flex gap-3 py-3 text-error hover:bg-error/10 rounded-lg font-medium group cursor-pointer">
            <div
              class="w-8 h-8 rounded-full bg-error/10 flex items-center justify-center group-hover:bg-error group-hover:text-white transition-colors duration-200">
              <i class="fas fa-sign-out-alt"></i>
            </div>
            <span class="text-sm">ออกจากระบบ</span>
          </a>
        </li>
      </ul>

    </div>
  </div>
</div>

<script>
  /**
   * ฟังก์ชันสำหรับอัปเดต UI ของ Navbar
   * @param {Object} user - ข้อมูลผู้ใช้ {userName: "...", userEmail: "..."}
   */
  window.updateNavbarUI = (user) => {
    if (!user) return;
    
    // 1. อัปเดตชื่อแสดงผล
    const nameEl = document.getElementById('nav-user-name');
    const menuNameEl = document.getElementById('nav-menu-name-display');
    const menuEmailEl = document.getElementById('nav-menu-email-display');
    
    const displayName = user.userName || user.name || 'Unknown';
    if (nameEl) nameEl.innerText = displayName;
    if (menuNameEl) menuNameEl.innerText = displayName;
    if (menuEmailEl) menuEmailEl.innerText = user.userEmail || '';

    // 2. จัดการรูปโปรไฟล์ (Avatar)
    const textEls = [document.getElementById('nav-avatar-text'), document.getElementById('nav-menu-avatar-text')];
    const imgEls = [document.getElementById('nav-avatar-img'), document.getElementById('nav-menu-avatar-img')];

    // เนื่องจากใช้ Login ผ่าน Sheet ปกติจะไม่มีรูปภาพ (Picture) 
    // เราจะใช้ตัวอักษรแรกของชื่อแทน
    const initial = displayName.charAt(0).toUpperCase();
    
    imgEls.forEach(el => { if(el) el.classList.add('hidden'); });
    textEls.forEach(el => { 
      if(el) {
        el.classList.remove('hidden');
        el.innerText = initial;
      } 
    });
  };

</script>