<script>
  // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÑ‡∏ß‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏±‡∏ô
  const savedLastPage = localStorage.getItem("gas_last_page");
  let isAppReady = false;

  document.addEventListener("DOMContentLoaded", async () => {
    console.log("üöÄ App Starting...");

    // 1. Sidebar Links
    document.querySelectorAll("aside a[data-target]").forEach((el) => {
      el.addEventListener("click", (e) => {
        e.preventDefault();
        const target = el.dataset.target;
        Router.navigateTo(target);

        const drawer = document.getElementById("my-drawer");
        if (drawer) drawer.checked = false;
      });
    });

    // 2. ‡∏à‡∏±‡∏ö Event ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
    document.addEventListener("page-change", (e) => {
      if (isAppReady && e.detail && e.detail.pageId) {
        localStorage.setItem("gas_last_page", e.detail.pageId);
      }
    });

    // 3. Initialize Data
    try {
      if (typeof Store !== "undefined" && Store.init) {
        await Store.init(); // ‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• User
      }

      // ‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°
      if (
        savedLastPage &&
        savedLastPage !== "undefined" &&
        document.getElementById(savedLastPage)
      ) {
        Router.navigateTo(savedLastPage);
      } else {
        Router.navigateTo("page-dashboard");
      }
    } catch (e) {
      console.error("App Init Failed", e);
      Router.navigateTo("page-dashboard");
    } finally {
      // ‚ú® 4. ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î
      setTimeout(() => {
        isAppReady = true;

        // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡πâ‡∏≤ Splash Screen
        const splashScreen = document.getElementById("initial-splash-screen");
        if (splashScreen) {
          // ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏à‡∏≤‡∏á‡∏´‡∏≤‡∏¢‡πÑ‡∏õ (Fade out)
          splashScreen.style.opacity = "0";

          // ‡∏û‡∏≠‡∏à‡∏≤‡∏á‡∏´‡∏≤‡∏¢‡πÄ‡∏™‡∏£‡πá‡∏à (500ms) ‡πÉ‡∏´‡πâ‡∏•‡∏ö‡∏ó‡∏¥‡πâ‡∏á‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏¢ ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏Å‡∏¥‡∏ô‡πÅ‡∏£‡∏°
          setTimeout(() => {
            splashScreen.remove();
            console.log("‚úÖ App is fully ready.");
          }, 500);
        }
      }, 500); // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ Router ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡∏Å
    }
  });
</script>
