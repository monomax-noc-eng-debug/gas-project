<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô GAS</title>

  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.7.2/dist/full.min.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.tailwindcss.com"></script>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pikaday/css/pikaday.css">
  <script src="https://cdn.jsdelivr.net/npm/pikaday/pikaday.js"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/locale/th.js"></script>
  <script>
    dayjs.locale('th');
  </script>

  <script>
    tailwind.config = {
      theme: {
        extend: { fontFamily: { sans: ['Sarabun', 'sans-serif'] } }
      }
    }
  </script>
  <?!= include('frontend/styles/CSS_Custom'); ?>

  <style>
    .pika-single {
      background: #1f2937;
      /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ó‡∏≤ (Gray-800) */
      border: 1px solid #374151;
      /* ‡∏Ç‡∏≠‡∏ö‡∏™‡∏µ‡πÄ‡∏ó‡∏≤ (Gray-700) */
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
      color: #fff;
      font-family: 'Sarabun', sans-serif;
    }

    /* ‡∏´‡∏±‡∏ß‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô */
    .pika-label {
      background-color: #1f2937;
      color: #f3f4f6;
      /* ‡∏Ç‡∏≤‡∏ß‡∏ô‡∏ß‡∏• */
      font-weight: bold;
    }

    .pika-prev,
    .pika-next {
      opacity: 0.7;
    }

    .pika-prev:hover,
    .pika-next:hover {
      opacity: 1;
      background-color: #374151;
      border-radius: 4px;
    }

    /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏ô */
    .pika-table th {
      color: #9ca3af;
      /* ‡πÄ‡∏ó‡∏≤‡∏≠‡πà‡∏≠‡∏ô */
    }

    .pika-button {
      color: #e5e7eb;
      /* ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ß‡∏±‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */
      background: transparent;
      border-radius: 8px;
      text-align: center;
    }

    .pika-button:hover {
      background: #374151 !important;
      /* Hover ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡πÄ‡∏Ç‡πâ‡∏° */
      color: #fff !important;
    }

    /* ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (Selected) */
    .is-selected .pika-button {
      background: #3b82f6 !important;
      /* ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô (Blue-500) */
      box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
      color: #fff;
      font-weight: bold;
    }

    /* ‡∏ß‡∏±‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (Today) */
    .is-today .pika-button {
      color: #3b82f6;
      font-weight: bold;
    }

    /* üîß Fix: Prevent Layout Shift from SweetAlert2 */
    body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown) {
      padding-right: 0 !important;
      overflow-y: hidden !important;
    }
  </style>
</head>

<body class="bg-base-200 text-base-content font-sans h-screen overflow-hidden">

  <div id="login-page"
    class="fixed inset-0 z-[100] flex items-center justify-center bg-base-300 p-4 transition-all duration-500">
    <div class="card w-full max-w-md bg-white shadow-2xl border border-base-300">
      <div class="card-body items-center text-center">
        <div class="bg-primary/10 p-4 rounded-full mb-2">
          <i class="fas fa-lock text-3xl text-primary"></i>
        </div>
        <h2 class="card-title text-2xl font-bold text-gray-800 border-none">Daily Report System</h2>
        <p class="text-sm text-gray-400 mb-6">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠</p>

        <div class="form-control w-full">
          <label class="label"><span class="label-text font-semibold">‡∏≠‡∏µ‡πÄ‡∏°‡∏• / ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</span></label>
          <input type="text" id="login-user" placeholder="example@email.com" class="input input-bordered w-full focus:input-primary" />
        </div>

        <div class="form-control w-full mt-4">
          <label class="label"><span class="label-text font-semibold">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (PIN)</span></label>
          <input type="password" id="login-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="input input-bordered w-full focus:input-primary" onkeyup="if(event.key === 'Enter') handleLogin()" />
        </div>

        <div class="card-actions w-full mt-8">
          <button id="btn-login-submit" onclick="handleLogin()" class="btn btn-primary w-full shadow-lg text-white">
            <span id="login-spinner" class="loading loading-spinner hidden"></span>
            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
          </button>
        </div>
      </div>
    </div>
  </div>

  <div id="main-app" class="drawer lg:drawer-open h-full opacity-0 pointer-events-none transition-opacity duration-500">
    <input id="my-drawer" type="checkbox" class="drawer-toggle" />
    <div class="drawer-content flex flex-col h-full overflow-hidden relative">
      <?!= include('frontend/components/Part_Navbar'); ?>

      <div class="hidden">
        <span id="display-user-name"></span>
        <span id="display-user-email"></span>
      </div>

      <main class="flex-1 overflow-y-auto scroll-smooth relative w-full">
        <?!= include('frontend/pages/Page_Dashboard'); ?>
        <?!= include('frontend/pages/Page_Report'); ?>
        <?!= include('frontend/pages/Page_Ticket'); ?>
        <?!= include('frontend/pages/Page_History'); ?>
        <?!= include('frontend/pages/Page_Settings'); ?>
      </main>
    </div>
    <div class="drawer-side z-50">
      <label for="my-drawer" aria-label="close sidebar" class="drawer-overlay"></label>
      <?!= include('frontend/components/Part_Sidebar'); ?>
    </div>
  </div>

  <?!= include('frontend/components/Part_Modal_Core'); ?>

  <script>
    /**
     * Logic ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Login
     */
    function handleLogin() {
    const email = document.getElementById('login-user').value;
    const pass = document.getElementById('login-pass').value;
    const btn = document.getElementById('btn-login-submit');
    const spinner = document.getElementById('login-spinner');

    if (!email || !pass) {
      return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'warning');
    }

    btn.disabled = true;
    spinner.classList.remove('hidden');

    google.script.run
      .withSuccessHandler(function(res) {
        btn.disabled = false;
        spinner.classList.add('hidden');

        if (res.success) {
          // ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á LocalStorage
          localStorage.setItem('gas_app_user', JSON.stringify(res));

          const loginPage = document.getElementById('login-page');
          const mainApp = document.getElementById('main-app');
          
          loginPage.classList.add('opacity-0', 'pointer-events-none');
          mainApp.classList.remove('pointer-events-none', 'opacity-0');
          
          if (window.updateNavbarUI) {
            window.updateNavbarUI(res); 
          }

          if (window.Dashboard && typeof window.Dashboard.init === 'function') {
            window.Dashboard.init();
          }
          
          Swal.fire({
            icon: 'success', title: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', text: '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì ' + res.userName,
            timer: 1500, showConfirmButton: false, toast: true, position: 'top-end'
          });
        } else {
          Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', res.message, 'error');
        }
      })
      .withFailureHandler(function(err) {
        btn.disabled = false;
        spinner.classList.add('hidden');
        Swal.fire('Error', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå', 'error');
      })
      .apiLogin(email, pass); 
  }

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö (Logout)
     * ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Part_Navbar ‡∏´‡∏£‡∏∑‡∏≠ Part_Sidebar
     */
function handleLogout() {
  Swal.fire({
    title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?',
    icon: 'question',
    showCancelButton: true,
    confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö',
    cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
    confirmButtonColor: '#d33'
  }).then((result) => {
    if (result.isConfirmed) {
      // ‚úÖ ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô LocalStorage
      localStorage.removeItem('gas_app_user');
      
      // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Login ‡πÅ‡∏•‡∏∞‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
      location.reload();
    }
  });
}

    // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
document.addEventListener('DOMContentLoaded', function() {
  const savedUser = localStorage.getItem('gas_app_user');
  
  if (savedUser) {
    try {
      const user = JSON.parse(savedUser);
      
      // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤ Login ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
      const loginPage = document.getElementById('login-page');
      const mainApp = document.getElementById('main-app');
      
      if (loginPage && mainApp) {
        loginPage.classList.add('hidden'); // ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡πÄ‡∏•‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ Transition
        mainApp.classList.remove('opacity-0', 'pointer-events-none');
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏ï‡πà‡∏≤‡∏á‡πÜ
        if (window.updateNavbarUI) window.updateNavbarUI(user);
        
        // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö Core ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏° Init
        setTimeout(() => {
          if (window.Dashboard && typeof window.Dashboard.init === 'function') {
             window.Dashboard.init();
          }
        }, 500);
      }
    } catch (e) {
      console.error("LocalStorage Parse Error", e);
      localStorage.removeItem('gas_app_user'); // ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏´‡πâ‡∏•‡∏ö‡∏ó‡∏¥‡πâ‡∏á
    }
  }
});
  </script>

  <?!= include('frontend/scripts/JS_Core'); ?>
  <?!= include('frontend/scripts/JS_Dashboard'); ?>
  <?!= include('frontend/scripts/JS_Report'); ?>
  <?!= include('frontend/scripts/JS_Ticket_Service'); ?>
  <?!= include('frontend/scripts/JS_Ticket_View'); ?>
  <?!= include('frontend/scripts/JS_Ticket_Email'); ?>
  <?!= include('frontend/scripts/JS_Ticket_Controller'); ?>
  <?!= include('frontend/scripts/JS_History'); ?>
  <?!= include('frontend/scripts/JS_Settings'); ?>
  <?!= include('frontend/scripts/JS_App'); ?>

</body>

</html>