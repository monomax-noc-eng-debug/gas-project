<!-- Page_Ticket.html - Vanilla JS Structure -->
<div id="page-ticket" class="page-section hidden w-full h-full relative">

    <!-- Main Content -->
    <div class="absolute inset-0 flex flex-col p-4 space-y-4">

        <!-- Stats Cards -->
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-2">
            <!-- Total -->
            <div class="stat bg-base-100/80 backdrop-blur rounded-lg border border-base-200 shadow-sm p-3">
                <div class="stat-title text-[10px] font-bold uppercase opacity-60">Total</div>
                <div class="stat-value text-lg" id="stat-total">0</div>
            </div>
            <!-- Open -->
            <div class="stat bg-base-100/80 backdrop-blur rounded-lg border border-base-200 shadow-sm p-3 text-error">
                <div class="stat-title text-[10px] font-bold uppercase opacity-60">Open</div>
                <div class="stat-value text-lg" id="stat-open">0</div>
            </div>
            <!-- Pending -->
            <div class="stat bg-base-100/80 backdrop-blur rounded-lg border border-base-200 shadow-sm p-3 text-warning">
                <div class="stat-title text-[10px] font-bold uppercase opacity-60">Pending</div>
                <div class="stat-value text-lg" id="stat-pending">0</div>
            </div>
            <!-- Resolved -->
            <div class="stat bg-base-100/80 backdrop-blur rounded-lg border border-base-200 shadow-sm p-3 text-success">
                <div class="stat-title text-[10px] font-bold uppercase opacity-60">Resolved</div>
                <div class="stat-value text-lg" id="stat-resolved">0</div>
            </div>
            <!-- Closed -->
            <div class="stat bg-base-100/80 backdrop-blur rounded-lg border border-base-200 shadow-sm p-3 text-neutral">
                <div class="stat-title text-[10px] font-bold uppercase opacity-60">Closed</div>
                <div class="stat-value text-lg" id="stat-closed">0</div>
            </div>
            <!-- Request -->
            <div class="stat bg-base-100/80 backdrop-blur rounded-lg border border-base-200 shadow-sm p-3 text-info">
                <div class="stat-title text-[10px] font-bold uppercase opacity-60">Request</div>
                <div class="stat-value text-lg" id="stat-request">0</div>
            </div>
            <!-- Incident -->
            <div
                class="stat bg-base-100/80 backdrop-blur rounded-lg border border-base-200 shadow-sm p-3 text-secondary">
                <div class="stat-title text-[10px] font-bold uppercase opacity-60">Incident</div>
                <div class="stat-value text-lg" id="stat-incident">0</div>
            </div>
        </div>

        <!-- Toolbar -->
        <div
            class="flex flex-col md:flex-row justify-between items-center bg-base-100 p-3 rounded-xl shadow-sm border border-base-200 gap-3">
            <div class="flex items-center gap-3 w-full md:w-auto">
                <div class="relative w-full md:w-64">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-base-content/40 text-xs"></i>
                    <input type="text" id="ticket-search" onkeyup="TicketManager.filterData()"
                        placeholder="ค้นหา Ticket..." class="input input-bordered input-sm w-full pl-9 rounded-md">
                </div>
            </div>

            <div class="flex gap-2 w-full md:w-auto justify-end">
                <button onclick="TicketManager.loadTickets(true)"
                    class="btn btn-ghost btn-square btn-sm tooltip tooltip-bottom" data-tip="รีเฟรช">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button onclick="TicketManager.openModal('CREATE')" class="btn btn-primary btn-sm gap-2 shadow-md">
                    <i class="fas fa-plus"></i> เพิ่ม Ticket
                </button>
            </div>
        </div>

        <!-- Table Container -->
        <div
            class="flex-1 bg-base-100 rounded-xl shadow-sm border border-base-200 overflow-hidden flex flex-col relative">

            <!-- Loading -->
            <div id="ticket-loader"
                class="absolute inset-0 bg-base-100/80 z-20 flex flex-col items-center justify-center backdrop-blur-sm hidden">
                <span class="loading loading-spinner loading-lg text-primary"></span>
                <p class="mt-2 text-base-content/60 animate-pulse">กำลังโหลดข้อมูล...</p>
            </div>

            <!-- Empty -->
            <div id="ticket-empty"
                class="absolute inset-0 flex flex-col items-center justify-center text-base-content/40 hidden z-10">
                <i class="fas fa-ticket-alt text-4xl mb-4 opacity-30"></i>
                <p>ไม่พบรายการ Ticket</p>
            </div>

            <!-- Table -->
            <div class="overflow-x-auto flex-1 h-full">
                <table class="table table-pin-rows table-xs w-full whitespace-nowrap">
                    <thead>
                        <tr class="bg-base-200/50 text-base-content/70">
                            <th class="w-12 text-center">No.</th>
                            <th class="w-24 text-center">Date</th>
                            <th class="w-24 text-center">ID</th>
                            <th>Subject</th>
                            <th class="w-24 text-center">Type</th>
                            <th class="w-24 text-center">Severity</th>
                            <th class="w-24 text-center">Status</th>
                            <th class="w-24 text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="ticket-table-body">
                        <!-- Rows -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Create/Edit Modal -->
    <dialog id="modal-ticket-form" class="modal modal-bottom sm:modal-middle">
        <div class="modal-box w-11/12 max-w-5xl bg-base-100 p-0 rounded-2xl overflow-hidden shadow-2xl">
            <!-- Header -->
            <div
                class="bg-base-100 px-6 py-4 border-b border-base-200 flex justify-between items-center sticky top-0 z-50">
                <h3 class="font-bold text-lg flex items-center gap-2">
                    <i class="fas fa-ticket-alt text-primary"></i>
                    <span id="ticket-modal-title">จัดการ Ticket</span>
                </h3>
                <form method="dialog">
                    <button class="btn btn-sm btn-circle btn-ghost">✕</button>
                </form>
            </div>

            <!-- Body -->
            <form id="form-ticket" onsubmit="TicketManager.handleSubmit(event)"
                class="p-6 space-y-4 overflow-y-auto max-h-[calc(100vh-14rem)] bg-base-50/50">
                <input type="hidden" name="id" id="inp-ticket-id">

                <!-- Row 1: Date/Time/Type/Status -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="form-control">
                        <label class="label"><span class="label-text text-xs font-bold">Date</span></label>
                        <input type="date" name="date" required class="input input-bordered input-sm"
                            id="inp-ticket-date">
                    </div>
                    <div class="form-control">
                        <label class="label"><span class="label-text text-xs font-bold">Time</span></label>
                        <input type="time" name="time" required class="input input-bordered input-sm"
                            id="inp-ticket-time">
                    </div>
                    <div class="form-control">
                        <label class="label"><span class="label-text text-xs font-bold">Type</span></label>
                        <select name="type" class="select select-bordered select-sm" id="sel-ticket-type"></select>
                    </div>
                    <div class="form-control">
                        <label class="label"><span class="label-text text-xs font-bold">Status</span></label>
                        <select name="status" class="select select-bordered select-sm" id="sel-ticket-status"></select>
                    </div>
                </div>

                <!-- Row 2: Category/Severity -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="form-control">
                        <label class="label"><span class="label-text text-xs font-bold">Category</span></label>
                        <select name="category" class="select select-bordered select-sm" id="sel-ticket-category"
                            onchange="TicketManager.updateSubCategories()"></select>
                    </div>
                    <div class="form-control">
                        <label class="label"><span class="label-text text-xs font-bold">Sub Category</span></label>
                        <select name="subCategory" class="select select-bordered select-sm"
                            id="sel-ticket-subcategory"></select>
                    </div>
                    <div class="form-control">
                        <label class="label"><span class="label-text text-xs font-bold">Severity</span></label>
                        <select name="severity" class="select select-bordered select-sm"
                            id="sel-ticket-severity"></select>
                    </div>
                </div>

                <!-- Subject -->
                <div class="form-control">
                    <label class="label"><span class="label-text text-xs font-bold">Subject</span></label>
                    <input type="text" name="subject" required class="input input-bordered input-sm font-bold"
                        placeholder="หัวข้อปัญหา..." id="inp-ticket-subject">
                </div>

                <!-- Details -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-control">
                        <label class="label"><span class="label-text text-xs font-bold">Detail</span></label>
                        <textarea name="detail" class="textarea textarea-bordered h-32 text-xs"
                            placeholder="รายละเอียด..." id="txt-ticket-detail"></textarea>
                    </div>
                    <div class="form-control">
                        <label class="label"><span class="label-text text-xs font-bold">Action</span></label>
                        <textarea name="action" class="textarea textarea-bordered h-32 text-xs"
                            placeholder="การดำเนินการ..." id="txt-ticket-action"></textarea>
                    </div>
                </div>

                <!-- Resolution & People -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-control bg-success/5 p-3 rounded-lg border border-success/20">
                        <label class="label"><span
                                class="label-text text-xs font-bold text-success">Resolution</span></label>
                        <textarea name="resolvedDetail" class="textarea textarea-bordered h-24 text-xs"
                            placeholder="สิ่งที่แก้ไข..." id="txt-ticket-resolved"></textarea>
                    </div>
                    <div class="space-y-2">
                        <div class="form-control">
                            <label class="label"><span
                                    class="label-text text-xs font-bold">Responsibility</span></label>
                            <input type="text" name="responsibility" class="input input-bordered input-sm"
                                placeholder="ผู้รับผิดชอบ" id="inp-ticket-resp">
                        </div>
                        <div class="form-control">
                            <label class="label"><span class="label-text text-xs font-bold">Assignee</span></label>
                            <input type="text" name="assignee" class="input input-bordered input-sm"
                                placeholder="ผู้ได้รับมอบหมาย" id="inp-ticket-assign">
                        </div>
                    </div>
                </div>

                <!-- Remark -->
                <div class="form-control">
                    <label class="label"><span class="label-text text-xs font-bold">Remark</span></label>
                    <textarea name="remark" class="textarea textarea-bordered h-16 text-xs" placeholder="หมายเหตุ..."
                        id="txt-ticket-remark"></textarea>
                </div>

                <!-- Actions -->
                <div class="pt-4 flex justify-end gap-2 sticky bottom-0 bg-base-100 py-3 border-t border-base-200">
                    <button type="button" class="btn btn-ghost"
                        onclick="document.getElementById('modal-ticket-form').close()">Cancel</button>
                    <button type="submit" class="btn btn-primary min-w-[120px]" id="btn-save-ticket">
                        <span class="loading loading-spinner loading-xs hidden" id="spinner-save-ticket"></span>
                        Save
                    </button>
                </div>
            </form>
        </div>
        <form method="dialog" class="modal-backdrop"><button>close</button></form>
    </dialog>

</div>