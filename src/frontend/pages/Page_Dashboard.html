<div id="page-dashboard" class="page-section hidden w-full h-full relative font-sans bg-base-200">

  <style>
    .pika-single {
      z-index: 100000 !important;
    }

    dialog .swal2-container {
      z-index: 100000 !important;
    }
  </style>

  <div class="absolute inset-0 flex flex-col p-2 space-y-3 w-full overflow-y-auto custom-scrollbar">

    <div class="bg-base-100 p-3 rounded-xl shadow-sm border border-base-200">
      <div class="flex flex-col md:flex-row justify-between items-center gap-3">
        <div class="flex items-center gap-2 w-full md:w-auto justify-center md:justify-start">
          <button onclick="Dashboard.changeDate(-1)"
            class="btn btn-circle btn-ghost btn-sm text-base-content/70 hover:bg-base-200"><i
              class="fas fa-chevron-left"></i></button>
          <div class="relative group">
            <div
              class="flex items-center gap-2 px-4 py-2 bg-base-100 rounded-full border border-base-200 shadow-sm hover:border-primary/50 hover:shadow-md transition-all cursor-pointer group-hover:bg-base-50"
              onclick="document.getElementById('dash-date-input').click()">
              <i class="far fa-calendar-alt text-primary group-hover:scale-110 transition-transform"></i>
              <input type="text" id="dash-date-input"
                class="bg-transparent border-none outline-none text-base-content font-bold text-center w-32 cursor-pointer focus:ring-0 select-none text-lg"
                readonly>
            </div>
          </div>
          <button onclick="Dashboard.changeDate(1)"
            class="btn btn-circle btn-ghost btn-sm text-base-content/70 hover:bg-base-200"><i
              class="fas fa-chevron-right"></i></button>
          <div class="w-px h-8 bg-base-200 mx-2 hidden md:block"></div>
          <button onclick="Dashboard.loadWorkList(true)" class="btn btn-ghost btn-circle btn-sm tooltip tooltip-bottom"
            data-tip="รีเฟรชข้อมูล">
            <i id="dash-loader-icon"
              class="fas fa-sync-alt text-base-content/50 hover:text-primary transition-colors"></i>
          </button>
        </div>

        <div
          class="flex items-center gap-2 bg-base-200/50 p-1 rounded-lg border border-base-200 order-3 md:order-2 w-full md:w-auto justify-center">
          <div class="badge badge-lg gap-2 bg-white border-base-200 text-success shadow-sm py-3 px-3 h-10">
            <span class="relative flex h-2 w-2">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-success opacity-75"></span>
              <span class="relative inline-flex rounded-full h-2 w-2 bg-success"></span>
            </span>
            <span class="font-bold text-sm">LIVE</span>
            <span class="font-black text-md ml-1" id="stat-live">0</span>
          </div>
          <div class="badge badge-lg gap-2 bg-transparent border-transparent text-base-content/60 py-3 px-3 h-10">
            <span class="font-bold text-sm">DONE</span>
            <span class="font-black text-md ml-1" id="stat-done">0</span>
          </div>
        </div>

        <div class="flex items-center gap-2 w-full md:w-auto order-2 md:order-3 justify-end">
          <button onclick="Dashboard.openAddModal()"
            class="btn btn-sm btn-primary text-white shadow-md min-w-[130px] gap-2 hover:scale-105 transition-transform">
            <i class="fas fa-plus"></i> <span>เริ่มงานใหม่</span>
          </button>
        </div>
      </div>
    </div>

    <div
      class="flex-1 bg-base-100 rounded-xl shadow-sm border border-base-200 overflow-hidden flex flex-col relative min-h-[400px]">
      <div id="dash-loader"
        class="absolute inset-0 bg-white/80 z-20 flex flex-col items-center justify-center hidden backdrop-blur-[1px]">
        <span class="loading loading-spinner loading-lg text-primary"></span>
        <p class="mt-2 text-sm font-medium text-base-content/60 animate-pulse">กำลังโหลดข้อมูล...</p>
      </div>

      <div id="dash-empty"
        class="absolute inset-0 flex flex-col items-center justify-center text-base-content/40 hidden z-10 pointer-events-none">
        <div class="bg-base-200/50 p-6 rounded-full mb-4">
          <i class="fas fa-clipboard-list text-4xl opacity-40"></i>
        </div>
        <h3 class="font-bold text-lg text-base-content/70">ยังไม่มีรายการงานในวันนี้</h3>
        <p class="text-xs mt-1 opacity-60">กดปุ่ม "เริ่มงานใหม่" เพื่อเพิ่มรายการ</p>
      </div>

      <div class="overflow-x-auto flex-1 h-full w-full">
        <table class="table table-sm w-full table-fixed">
          <thead class="bg-base-200/50 text-xs uppercase font-bold text-base-content/60 sticky top-0 z-10 h-12">
            <tr>
              <th class="w-20 text-center rounded-tl-xl">เวลา</th>
              <th class="w-auto min-w-[200px] pl-4">รายการแข่งขัน</th>
              <th class="w-20 text-center">ช่อง</th>
              <th class="w-24 text-center text-primary">รูปเริ่ม (Start)</th>
              <th class="w-24 text-center text-error">รูปจบ (Stop)</th>
              <th class="w-28 text-center">สถานะ (Status)</th>
              <th class="w-20 text-center rounded-tr-xl">จัดการ</th>
            </tr>
          </thead>
          <tbody id="work-list-body" class="text-sm align-middle bg-white divide-y divide-base-200/50">
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <dialog id="modal-add-work" class="modal modal-bottom sm:modal-middle">
    <div class="modal-box bg-base-100 w-11/12 max-w-4xl p-0 overflow-visible rounded-2xl shadow-2xl">
      <div
        class="bg-primary px-5 py-3 flex justify-between items-center text-primary-content shadow-md z-10 rounded-t-2xl">
        <div class="flex items-center gap-2">
          <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center"><i
              class="fas fa-edit text-sm"></i></div>
          <span id="modal-title-work" class="font-bold text-lg">จัดการข้อมูล</span>
        </div>
        <form method="dialog"><button class="btn btn-sm btn-circle btn-ghost text-white hover:bg-white/20">✕</button>
        </form>
      </div>

      <div class="p-6 bg-base-50/50 max-h-[80vh] overflow-y-auto custom-scrollbar">
        <div id="section-import" class="mb-4">
          <div
            class="bg-white rounded-xl border border-base-200 shadow-sm overflow-visible transition-all duration-300 group relative z-20"
            id="import-container">
            <div
              class="p-3 flex items-center justify-between bg-base-100 cursor-pointer hover:bg-base-200/50 transition-colors"
              onclick="Dashboard.toggleCalendar()">
              <div class="flex items-center gap-2 text-sm font-bold text-primary">
                <i class="fas fa-calendar-alt"></i><span>ดึงข้อมูลจาก Calendar</span>
              </div>
              <i class="fas fa-chevron-down text-base-content/40 transition-transform duration-300 group-hover:text-primary"
                id="import-chevron"></i>
            </div>

            <div id="import-content" class="hidden border-t border-base-200 bg-base-50 p-3">
              <div class="flex gap-2 mb-2 relative">
                <input type="date" id="import-date-picker"
                  class="input input-sm input-bordered w-full text-center cursor-pointer" placeholder="เลือกวันที่">
                <button class="btn btn-sm btn-square btn-primary" onclick="Dashboard.fetchCalendarEvents()"><i
                    class="fas fa-search"></i></button>
              </div>
              <div
                class="relative min-h-[100px] max-h-[200px] overflow-y-auto custom-scrollbar rounded border border-base-200 bg-white">
                <div id="cal-loader" class="absolute inset-0 bg-base-50 flex items-center justify-center hidden z-10">
                  <span class="loading loading-spinner text-primary"></span>
                </div>
                <div id="calendar-picker-list" class="p-2 space-y-1">
                  <div class="text-center text-xs text-base-content/40 py-8">เลือกวันที่และกดค้นหา</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <form id="form-add-work" class="space-y-4">
          <input type="hidden" id="input-edit-id">

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="space-y-3">
              <div class="divider text-xs font-bold text-base-content/30 my-0 mb-2">ข้อมูลทั่วไป</div>
              <div class="grid grid-cols-2 gap-3">
                <div class="form-control">
                  <label class="label pb-1"><span
                      class="label-text text-xs font-bold uppercase text-base-content/60">วันที่ (Date)</span></label>
                  <input type="date" id="input-date" name="date"
                    class="input input-bordered w-full font-mono text-sm cursor-pointer bg-white" required>
                </div>
                <div class="form-control">
                  <label class="label pb-1"><span
                      class="label-text text-xs font-bold uppercase text-base-content/60">เวลา (Time)</span></label>
                  <input type="time" id="input-time" name="time" class="input input-bordered w-full font-mono text-sm"
                    required>
                </div>
              </div>
              <div class="form-control">
                <label class="label pb-1"><span class="label-text text-xs font-bold uppercase text-base-content/60">ลีก
                    (League)</span></label>
                <input type="text" id="input-league" name="league" class="input input-bordered w-full text-sm"
                  placeholder="เช่น Premier League" required>
              </div>
              <div class="p-3 bg-white rounded-xl border border-base-200 shadow-sm">
                <label class="label pt-0 pb-2"><span
                    class="label-text text-xs font-bold uppercase text-base-content/60">คู่แข่งขัน (Match
                    Pair)</span></label>
                <div class="flex items-center gap-2">
                  <input type="text" id="input-home" name="home" oninput="Dashboard.checkFormInput()"
                    class="input input-sm input-ghost w-full text-center font-bold text-base-content placeholder:font-normal bg-base-100 focus:bg-white transition-colors rounded-lg"
                    placeholder="ทีมเหย้า" required>
                  <span class="text-xs font-black text-base-content/30 bg-base-200 px-2 py-1 rounded-md">VS</span>
                  <input type="text" id="input-away" name="away" oninput="Dashboard.checkFormInput()"
                    class="input input-sm input-ghost w-full text-center font-bold text-base-content placeholder:font-normal bg-base-100 focus:bg-white transition-colors rounded-lg"
                    placeholder="ทีมเยือน" required>
                </div>
              </div>
              <div class="form-control">
                <label class="label pb-1"><span class="label-text text-xs font-bold uppercase text-base-content/60">ช่อง
                    (Channel)</span></label>
                <input type="text" id="input-channel" name="channel" class="input input-bordered w-full text-sm"
                  placeholder="เช่น Sports 1">
              </div>
            </div>

            <div class="space-y-3">
              <div class="divider text-xs font-bold text-base-content/30 my-0 mb-2">หลักฐาน (Images)</div>

              <div id="section-img-start" class="bg-primary/5 rounded-xl border border-primary/20 p-3 h-auto">
                <label class="label pt-0 pb-2"><span
                    class="label-text font-bold text-primary flex items-center gap-2"><i class="fas fa-play-circle"></i>
                    รูปเริ่มงาน (Optional)</span></label>

                <div id="wrapper-preview-start"
                  class="relative w-full h-32 bg-white rounded-lg border-2 border-dashed border-primary/20 flex items-center justify-center overflow-hidden group mb-2 hidden">
                  <img id="preview-start-img" class="h-full object-contain">
                  <div
                    class="absolute inset-0 bg-black/50 hidden group-hover:flex items-center justify-center transition-opacity gap-2">
                    <button type="button"
                      onclick="Dashboard.viewImage(document.getElementById('preview-start-img').src)"
                      class="btn btn-circle btn-sm btn-ghost text-white"><i class="fas fa-search"></i></button>
                    <button type="button" onclick="Dashboard.clearImage('start')"
                      class="btn btn-circle btn-sm btn-error text-white shadow-lg"><i class="fas fa-times"></i></button>
                  </div>
                </div>

                <div id="box-upload-start" class="flex gap-2">
                  <input type="file" id="input-start-img" accept="image/*" class="hidden"
                    onchange="Dashboard.handleFileSelect(this, 'start')">
                  <button type="button" onclick="document.getElementById('input-start-img').click()"
                    class="btn btn-sm btn-outline btn-primary flex-1 gap-1 bg-white text-xs">
                    <i class="fas fa-upload"></i> อัปโหลด
                  </button>
                  <button type="button" onclick="Dashboard.triggerPaste('start')"
                    class="btn btn-sm btn-outline btn-primary flex-1 gap-1 bg-white text-xs">
                    <i class="fas fa-paste"></i> วางรูป
                  </button>
                </div>
                <textarea id="paste-area-start" class="opacity-0 w-0 h-0 absolute pointer-events-none"></textarea>
              </div>

              <div id="section-img-stop" class="bg-error/5 rounded-xl border border-error/20 p-3 h-auto hidden">
                <label class="label pt-0 pb-2"><span class="label-text font-bold text-error flex items-center gap-2"><i
                      class="fas fa-stop-circle"></i> รูปจบงาน (Stop)</span></label>
                <div id="wrapper-preview-stop"
                  class="relative w-full h-32 bg-white rounded-lg border-2 border-dashed border-error/20 flex items-center justify-center overflow-hidden group mb-2 hidden">
                  <img id="preview-stop-img" class="h-full object-contain">
                  <div
                    class="absolute inset-0 bg-black/50 hidden group-hover:flex items-center justify-center transition-opacity gap-2">
                    <button type="button" onclick="Dashboard.viewImage(document.getElementById('preview-stop-img').src)"
                      class="btn btn-circle btn-sm btn-ghost text-white"><i class="fas fa-search"></i></button>
                    <button type="button" onclick="Dashboard.clearImage('stop')"
                      class="btn btn-circle btn-sm btn-error text-white shadow-lg"><i class="fas fa-times"></i></button>
                  </div>
                </div>
                <div id="box-upload-stop" class="flex gap-2">
                  <input type="file" id="inp-file-stop" accept="image/*" class="hidden"
                    onchange="Dashboard.handleFileSelect(this, 'stop')">
                  <button type="button" onclick="document.getElementById('inp-file-stop').click()"
                    class="btn btn-sm btn-outline btn-error flex-1 gap-1 bg-white text-xs">
                    <i class="fas fa-upload"></i> อัปโหลด
                  </button>
                  <button type="button" onclick="Dashboard.triggerPaste('stop')"
                    class="btn btn-sm btn-outline btn-error flex-1 gap-1 bg-white text-xs">
                    <i class="fas fa-paste"></i> วางรูป
                  </button>
                </div>
                <textarea id="paste-area-stop" class="opacity-0 w-0 h-0 absolute pointer-events-none"></textarea>
              </div>
            </div>
          </div>
        </form>
      </div>

      <div class="p-4 bg-white border-t border-base-200 flex justify-between items-center rounded-b-2xl">
        <button type="button" id="btn-delete-work" onclick="Dashboard.handleDeleteWork()"
          class="btn btn-outline btn-error gap-2 hidden">
          <i class="fas fa-trash-alt"></i> ลบรายการ
        </button>

        <div class="flex gap-2 ml-auto">
          <form method="dialog"><button class="btn btn-ghost">ยกเลิก</button></form>
          <button type="button" onclick="Dashboard.handleSubmitWork()" class="btn btn-primary shadow-lg gap-2 px-6"
            id="btn-submit-start">
            <span class="loading loading-spinner loading-xs hidden" id="spinner-submit-start"></span>
            <i class="fas fa-save"></i> <span>บันทึก</span>
          </button>
        </div>
      </div>
    </div>
    <form method="dialog" class="modal-backdrop bg-black/50 backdrop-blur-[2px]"><button>close</button></form>
  </dialog>

  <dialog id="modal-stop-work" class="modal modal-bottom sm:modal-middle">
    <div class="modal-box bg-base-100 max-w-sm p-0 rounded-2xl overflow-hidden shadow-2xl">
      <div class="bg-error text-error-content px-6 py-4 flex items-center justify-between">
        <h3 class="font-bold text-lg flex items-center gap-2"><i class="fas fa-stop-circle"></i> จบงาน (Stop)</h3>
        <form method="dialog"><button class="btn btn-sm btn-circle btn-ghost text-white/80 hover:bg-white/20">✕</button>
        </form>
      </div>
      <div class="p-6 space-y-4">
        <input type="hidden" id="inp-stop-id-quick">

        <div class="bg-error/5 rounded-xl border border-error/20 p-4">
          <label class="label pt-0"><span class="label-text text-xs font-bold text-gray-500">หลักฐานรูปถ่าย
              (Optional)</span></label>
          <div id="wrapper-preview-stop-quick"
            class="relative w-full h-40 bg-white rounded-lg border-2 border-dashed border-error/20 flex items-center justify-center overflow-hidden group mb-3 hidden">
            <img id="preview-stop-quick-img" class="h-full w-full object-contain">
            <div
              class="absolute inset-0 bg-black/50 hidden group-hover:flex items-center justify-center transition-opacity">
              <button type="button" onclick="Dashboard.clearImage('stop-quick')"
                class="btn btn-circle btn-sm btn-error text-white shadow-lg"><i class="fas fa-times"></i></button>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-2">
            <input type="file" id="inp-file-stop-quick" accept="image/*" class="hidden"
              onchange="Dashboard.handleFileSelect(this, 'stop-quick')">
            <button type="button" onclick="document.getElementById('inp-file-stop-quick').click()"
              class="btn btn-outline btn-error btn-sm flex flex-col h-auto py-2 gap-1"><i
                class="fas fa-upload text-lg"></i> <span class="text-[10px]">อัปโหลดรูป</span></button>
            <button type="button" onclick="Dashboard.triggerPaste('stop-quick')"
              class="btn btn-outline btn-error btn-sm flex flex-col h-auto py-2 gap-1"><i
                class="fas fa-paste text-lg"></i> <span class="text-[10px]">วางรูป (Ctrl+V)</span></button>
          </div>
          <textarea id="paste-area-stop-quick" class="opacity-0 w-0 h-0 absolute pointer-events-none"></textarea>
        </div>

        <div class="grid grid-cols-2 gap-3 mt-2">
          <button id="btn-submit-stop" onclick="Dashboard.submitStopWork(false)"
            class="btn btn-neutral text-white shadow-md">
            <i class="fas fa-camera mr-1"></i> ส่งรูปจบงาน
          </button>
          <button id="btn-submit-stop-skip" onclick="Dashboard.submitStopWork(true)"
            class="btn btn-outline btn-error hover:text-white">
            <i class="fas fa-fast-forward mr-1"></i> ยืนยันทันที
          </button>
        </div>
        <p class="text-[10px] text-center text-gray-400 mt-1">*ปุ่มขวาใช้กรณีเร่งด่วน หรือไม่มีรูปถ่าย</p>
        <div class="flex justify-center mt-2">
          <span class="loading loading-spinner loading-md text-error hidden" id="spinner-submit-stop"></span>
        </div>
      </div>
    </div>
    <form method="dialog" class="modal-backdrop bg-black/50 backdrop-blur-[2px]"><button>close</button></form>
  </dialog>

  <dialog id="modal-view-image" class="modal">
    <div
      class="modal-box p-0 bg-transparent shadow-none max-w-5xl h-full max-h-screen flex items-center justify-center relative">
      <form method="dialog" class="absolute top-4 right-4 z-50">
        <button class="btn btn-circle btn-sm bg-black/50 text-white border-none hover:bg-black">✕</button>
      </form><img id="img-preview-target" class="max-w-full max-h-[90vh] object-contain rounded-lg shadow-2xl bg-black">
    </div>
    <form method="dialog" class="modal-backdrop bg-black/90"><button>close</button></form>
  </dialog>

</div>